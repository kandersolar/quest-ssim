#:include common.kv

<SSimScreen>:
    name: 'ssim'
    bus_list: bus_list
    BoxLayout:
        orientation: "vertical"
        padding: 5
        spacing: 5

        BoxLayout:
            orientation: "horizontal"
            size_hint: (1.0, 0.5)

            Label:
                text: "Project Name:"
                color: C(hex_black)
                size_hint: (0.33, 1.0)

            TextInput:
                text: "unnamed"
                multiline: False
                valign: "center"

        Button:
            text: "select grid model"
            on_press: root.select_grid_model()

        Button:
            text: "select storage"
            on_press: root.open_der_configuration()

        Button:
            text: "configure loads"
            on_press: root.open_load_configuration()

        Button:
            text: "configure metrics"
            on_press: root.open_metric_configuration()

        Button:
            text: "Run"
            on_press: root.do_run_simulation()

        TextInput:
            id: bus_list
            multiline: True

<DERConfigurationScreen>:
    name: "der-config"

    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"
            padding: 5
            height: 1.0

            BoxLayout:
                orientation: "vertical"
                padding: 5
                height: 0.95

                ScrollView:
                    size_hint: (1.0, 0.8)
                    MDList:
                        id: ess_list

                Button:
                    size_hint: (1.0, 0.1)
                    text: "New Storage"
                    on_press: root.new_storage()

                Button:
                    size_hint: (1.0, 0.1)
                    text: "Delete Storage"

            Button:
                text: "list of PV"


        BoxLayout:
            orientation: "horizontal"
            padding: 5
            spacing: 5

            Button:
                height: 10
                text: "back"
                on_press: root.manager.current = 'ssim'

            Button:
                height: 10
                text: "save"
                # Might need something different here to handle the
                on_press: root.manager.current = 'ssim'


<BusListitem>:

    LeftCheckBox:
        id: selected


<StorageConfigurationScreen>:
    name: "configure-storage"

    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"

            BoxLayout:
                orientation: "vertical"

                Label:
                    text: "device name"
                    color: "black"

                TextInput:
                    text: root.ess.name
                    on_text: root.ess.name = self.text
                    multiline: False

                Label:
                    text: "device power (kW)"
                    color: "black"

                BoxLayout:
                    orientation: "horizontal"

                    ScrollView:
                        MDList:
                            id: power_list

                    BoxLayout:
                        orientation: "vertical"

                        TextInput:
                            id: power_input
                            text: ""

                        Button:
                            text: "add power option"
                            on_release: root.add_power(float(power_input.text))

                Label:
                    text: "duration (hours)"
                    color: "black"

                BoxLayout:
                    orientation: "horizontal"

                    ScrollView:
                        MDList:
                            id: duration_list

                    BoxLayout:
                        orientation: "vertical"

                        TextInput:
                            id: duration_input
                            text: ""

                        Button:
                            text: "add duration option"
                            on_release: root.add_duration(float(duration_input.text))

            ScrollView:
                MDList:
                    id: bus_list

        BoxLayout:
            size_hint: (1.0, 0.05)
            orientation: "horizontal"
            Button:
                text: "back"
                on_press: root.cancel()

            Button:
                text: "save"
                on_press: root.save()


<LoadConfigurationScreen>:
    name: "load-config"

    BoxLayout:
        orientation: "vertical"

        Button:
            text: "back"
            on_press: root.manager.current = 'ssim'

<MetricConfigurationScreen>:
    name: "metric-config"

    BoxLayout:
        orientation: "vertical"

        Button:
            text: "back"
            on_press: root.manager.current = 'ssim'

<RunSimulationScreen>:
    name: "run-sim"

    BoxLayout:
        orientation: "vertical"   

        BoxLayout:
            orientation: "horizontal"
            padding: 5

            BoxLayout:
                orientation: "vertical"
                padding: 5
                Label:
                    text: "Configurations that will be evaluated:"
                    size_hint_y: None
                    height: 50
                ScrollView:
                    canvas.before:
                        Color:
                            rgba: .5, .5, .5, 1
                        Line:
                            width: 2
                            rectangle: self.x, self.y, self.width, self.height
                    MDList:
                        id: config_list

            BoxLayout:
                orientation: "vertical"
                padding: 5
                spacing: 5
                Label:
                    text: "Total number of configurations 256 (128 completed)"
                    size_hint_y: None
                    height: 50
                Button: 
                    text: "View Saved Results"
                Button: 
                    text: "Resume"
                Button:
                    text: "Remove Configuration"
                Button:
                    text: "Go"

        Button:
            text: "back"
            size_hint_y: None
            height: 100
            on_press: root.manager.current = 'ssim'

<ListItemWithCheckbox>:
    id: the_list_item
    markup: True

    LeftCheckbox:
        id: check
        active: True

    IconRightWidget:
        icon: 'trash-can-outline'
        theme_text_color: "Custom"
        text_color: 1, 0, 0, 1
        on_release:
            root.delete_item(the_list_item)

<SelectGridDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            path: "."
            filters: ["*.dss"]

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)

<NoGridPopupContent>:
    Label:
        text: 'A grid model has not yet been selected.  Please return to the main screen and choose a grid model before attempting to run an analysis.'
        text_size: self.width, None
        height: self.texture_size[1]

    Button:
        id: dismissBtn
        text: 'Dismiss'
        size_hint: 1, 0.2
